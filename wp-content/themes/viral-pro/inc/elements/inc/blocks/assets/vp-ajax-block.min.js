var vpBlockObjColl, vpBlockCache, ViralPro_Block, ViralPro_Grid_Helper, vpBlocks; "undefined" != typeof jQuery && function(e){"use strict"; vpBlockObjColl = [], vpBlockCache = {data:{}, remove:function(e){delete this.data[e]}, exist:function(e){return this.data.hasOwnProperty(e) && null !== this.data[e]}, get:function(e){return this.data[e]}, set:function(e, a){this.remove(e), this.data[e] = a}}, (ViralPro_Block = function(a){var t = this, i = e("#" + a).eq(0); t.blockId = a, t.action = i.data("action"), t.query = i.data("query"), t.items = i.data("items"), t.settings = i.data("settings"), t.blockType = t.settings.block_type, t.currentPage = i.data("current"), t.filterTaxonomy = i.data("filter-taxonomy"), t.filterTerm = i.data("filter-term"), t.maxPages = i.data("maxpages"); var n = i.find("ul.vp-block-filter-list > li.vp-block-filter-item"); t.filterWidths = [], n.each(function(){t.filterWidths.push(e(this).outerWidth())}), t._processNumberedPagination(), t.organizeFilters()}).prototype = {action:"", blockId:"", blockType:"", query:"", items:[], settings:"", currentPage:1, maxPages:1, filterTerm:"", filterTaxonomy:"", userAction:"next_prev", filterWidths:[], is_ajax_running:!1, doAjaxBlockRequest:function(a){var t = this, i = t._getObjectSignature(); if (vpBlockCache.exist(i)){t._doAjaxBlockLoadingStart(!0, a); var n = vpBlockCache.get(i); return t._doAjaxBlockProcessResponse(!0, n, a), t._doAjaxBlockLoadingEnd(!0, a), "cache_hit"}t._doAjaxBlockLoadingStart(!1, a); var r = t._getItemsToDisplay(), o = {action:t.action, blockId:t.blockId, query:t.query, items:r, settings:t.settings, blockType:t.blockType, currentPage:t.currentPage, maxpages:t.maxPages, filterTerm:t.filterTerm, filterTaxonomy:t.filterTaxonomy, userAction:a, "_ajax_nonce-vp-block":vp_ajax_object.block_nonce}; e.post(vp_ajax_object.ajax_url, o, function(e){vpBlockCache.set(i, e), t._doAjaxBlockProcessResponse(!1, e, a), t._doAjaxBlockLoadingEnd(!1, a)})}, organizeFilters:function(){var e = jQuery("#" + this.blockId); e.find(".vp-block-header, .vl-block-header").removeClass("vp-filter-ready"); var a = e.find(".vp-block-header, .vl-block-header").eq(0), t = this._getAvailableWidth(a); this._resizeFilters(a, t), e.find(".vp-block-header, .vl-block-header").addClass("vp-filter-ready")}, handleFilterAction:function(e){var a = e.closest(".vp-block"); if (a.find(".vp-block-filter-item").removeClass("vp-active"), e.parent().addClass("vp-active"), !0 !== this.is_ajax_running){var t = e.attr("data-term-id"), i = e.attr("data-taxonomy"); a.data("filter-term", t), a.data("filter-taxonomy", i), this.filterTerm = t, this.filterTaxonomy = i, this.currentPage = 1, this.doAjaxBlockRequest("filter")}}, handlePageNavigation:function(e){var a = "next", t = (e.closest(".vp-block"), e.data("page")); if (!e.is(".vp-current-page") && !0 !== this.is_ajax_running){if ("prev" == t){if (1 == this.currentPage)return; this.currentPage--, a = "prev"} else if ("next" == t){if (this.currentPage >= this.maxpages)return; this.currentPage++, a = "next"} else this.currentPage = t, a = "load_page"; this.doAjaxBlockRequest(a)}}, handleLoadMore:function(e){e.closest(".vp-block"); if (!(this.currentPage >= this.maxpages) && !0 !== this.is_ajax_running){this.currentPage++, this.doAjaxBlockRequest("load_more")}}, _doAjaxBlockLoadingStart:function(a, t){this.is_ajax_running = !0; var i = jQuery("#" + this.blockId); i.addClass("vp-processing"); var n = e("#" + this.blockId).find(".vp-block-inner"); "next" != t && "prev" != t && "filter" != t && "load_page" != t || (i.addClass("vp-fetching"), 0 == a && i.append('<div class="vp-loader-gif"><div></div></div>'), n.addClass("animated fadeOut"))}, _doAjaxBlockLoadingEnd:function(a, t){this.is_ajax_running = !1; var i = jQuery("#" + this.blockId); i.removeClass("vp-processing"), e(".vp-loader-gif").remove(); var n = i.find(".vp-block-inner"); switch (n.removeClass("animated fadeOut"), t){case"load_more":n.children("div").last().addClass("animated faster fadeInDownSmall"); break; case"next":case"load_page":case"prev":case"filter":n.find("div:first").addClass("animated faster fadeInDownSmall"), n.find("div:first").one("webkitAnimationEnd oanimationend msAnimationEnd animationend", function(e){n.find("div:first").removeClass("animated faster fadeInDownSmall")})}n.off("animationend webkitAnimationEnd oAnimationEnd"), this._ensureBlockObjectsAreVisible(i, t), e("img.vl-lazy").Lazy()}, _doAjaxBlockProcessResponse:function(a, t, i){var n = e.parseJSON(t); if (this.blockId === n.blockId){var r = e("#" + this.blockId); "load_more" === i?e(n.data).appendTo(r.find(".vp-block-inner")):(r.removeClass("vp-fetching"), r.find(".vp-block-inner").html(n.data)), r.attr("data-current", n.paged), r.attr("data-maxpages", n.maxpages), r.find(".vp-pagination .vp-page-nav.vp-current-page").removeClass("vp-current-page"), r.find('.vp-page-nav[data-page="' + parseInt(n.paged) + '"]').addClass("vp-current-page"), r.find('.vp-page-nav[data-page="next"]').removeClass("vp-disabled"), r.find('.vp-page-nav[data-page="prev"]').removeClass("vp-disabled"), !0 === n.hidePrev && r.find('.vp-page-nav[data-page="prev"]').addClass("vp-disabled"), !0 === n.hideNext && r.find('.vp-page-nav[data-page="next"]').addClass("vp-disabled"); var o = parseInt(n.maxpages); n.filterTerm.length?1 == o?r.find(".vp-page-nav").hide():r.find(".vp-page-nav").each(function(){var a = e(this).attr("data-page"); a.match("prev|next")?e(this).show():parseInt(a) > o?e(this).hide():e(this).show()}):r.find(".vp-page-nav").show(), this._processNumberedPagination(); var s = parseInt(n.remaining); this.settings.show_remaining && 0 !== s && r.find(".vp-pagination a.vp-load-more span").text(s), 0 === s?r.find(".vp-pagination a.vp-load-more").addClass("vp-disabled"):r.find(".vp-pagination a.vp-load-more").removeClass("vp-disabled")}}, _getObjectSignature:function(){var e = {blockId:this.blockId, blockType:this.blockType, query:"", settings:"", currentPage:this.currentPage, filterTerm:this.filterTerm, filterTaxonomy:this.filterTaxonomy}; return JSON.stringify(e)}, _processNumberedPagination:function(){var a = jQuery("#" + this.blockId), t = parseInt(a.attr("data-maxpages")), i = parseInt(a.attr("data-current")); if (a.find(".vp-page-nav.vp-dotted").remove(), t > 5){var n = !1; a.find(".vp-page-nav.vp-numbered").each(function(){var a = e(this).attr("data-page"), r = parseInt(a); if (r > 1 && r <= t){var o = e(this); r == i || r == i - 1 || r == i + 1 || r == i + 2?(n && e('<a class="vp-page-nav vp-dotted" href="#" data-page="">...</a>').insertBefore(o), o.show(), n = !1):r == t?(n && e('<a class="vp-page-nav vp-dotted" href="#" data-page="">...</a>').insertBefore(o), n = !1):(o.hide(), n = !0)}})}}, _getAvailableWidth:function(e){var a = e.width() - 200, t = 0; return e.find(".vp-block-title, .vl-block-title").length && (t = e.find(".vp-block-title, .vl-block-title").eq(0).width()), a > t?a -= t:a = 0, a}, _resizeFilters:function(a, t){var i = this, n = 0; if (0 != (r = a.find("ul.vp-block-filter-list")).length){var r = r.eq(0), o = a.find("ul.vp-block-filter-dropdown-list").eq(0), s = r.find("li.vp-block-filter-item"), l = o.find("li.vp-block-filter-item"), d = 0, c = !1; s.each(function(){var a = e(this); (n += i.filterWidths[d]) >= t && (i._moveFilterToDropdownList(a, o), c = !0), d++}), l.each(function(){var a = e(this); c?i._moveFilterToDropdownList(a, o):(n += i.filterWidths[d]) < t && i._moveFilterToMainList(a, r), d++}), i._toggleMoreDropdownList(a, o)}}, _moveFilterToDropdownList:function(e, a){e.detach(), a.append(e)}, _moveFilterToMainList:function(e, a){e.detach(), a.append(e)}, _toggleMoreDropdownList:function(e, a){var t = e.find(".vp-block-filter-dropdown").eq(0); 0 == a.find("li.vp-block-filter-item").length?t.hide():t.show(), setTimeout(function(){t.closest(".vp-block-header, .vl-block-header").addClass("vp-filter-ready")}, 1e3)}, _ensureBlockObjectsAreVisible:function(a, t){if (t.match(/^(next|prev|load_page)$/)){var i = e(window).scrollTop(), n = a.offset().top; n < i && e("html,body").animate({scrollTop:n - 60}, 800)}}, _getItemsToDisplay:function(){return this.items}}, vpBlocks = {getBlockObjById:function(e){var a = this._getBlockIndex(e); if ( - 1 !== a)return vpBlockObjColl[a]; var t = new ViralPro_Block(e); return vpBlockObjColl.push(t), t}, _getBlockIndex:function(a){var t = - 1; return e.each(vpBlockObjColl, function(e, i){if (i.blockId === a)return t = e, !1}), t}}, (ViralPro_Grid_Helper = function(e){this._$grid = e.find(".vp-block").eq(0)}).prototype = {_$grid:null, loadMoreOnScroll:function(){var a = null, t = this; return t._$grid.find(".vp-pagination a.vp-load-more").not(".vp-disabled").each(function(){var i = e(this); a = t._$grid.ViralProWaypoint(function(e){i.click(), this.destroy()}, {offset:"bottom-in-view"})}), a}, setupInfiniteScroll:function(){var e = this, a = e.loadMoreOnScroll(), t = e._$grid.find(".vp-block-inner")[0]; new MutationObserver(function(t){for (var i = !1, n = 0; n < t.length; n++){var r = t[n]; if ("childList" === r.type && r.addedNodes.length){i = !0; break}}i && (a && a[0].destroy(), a = e.loadMoreOnScroll())}).observe(t, {attributes:!1, childList:!0, characterData:!1, subtree:!0})}}}(jQuery);